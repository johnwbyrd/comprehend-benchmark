{
  "config": "comprehend",
  "repo_dir": "/tmp/swebench_iu299bow/matplotlib__matplotlib",
  "wall_time_seconds": 466,
  "git_diff": "diff --git a/lib/matplotlib/offsetbox.py b/lib/matplotlib/offsetbox.py\nindex 77768e7383..1b505ad77d 100644\n--- a/lib/matplotlib/offsetbox.py\n+++ b/lib/matplotlib/offsetbox.py\n@@ -1558,14 +1558,18 @@ class DraggableBase:\n \n     def disconnect(self):\n         \"\"\"Disconnect the callbacks.\"\"\"\n+        try:\n+            canvas = self.canvas\n+        except AttributeError:\n+            return\n         for cid in self.cids:\n-            self.canvas.mpl_disconnect(cid)\n+            canvas.mpl_disconnect(cid)\n         try:\n             c1 = self._c1\n         except AttributeError:\n             pass\n         else:\n-            self.canvas.mpl_disconnect(c1)\n+            canvas.mpl_disconnect(c1)\n \n     def save_offset(self):\n         pass\n",
  "claude_output": {
    "type": "result",
    "subtype": "success",
    "is_error": false,
    "duration_ms": 464675,
    "duration_api_ms": 477772,
    "num_turns": 36,
    "result": "The fix is clean and minimal. Here's the summary:\n\n**Bug**: `AttributeError: 'NoneType' object has no attribute 'canvas'` in `DraggableBase.disconnect()`.\n\n**Root cause**: Commit `dfaa991552` (\"Make draggable legends picklable\") changed `self.canvas` from a stored instance attribute to a property that computes `self.ref_artist.figure.canvas` on each access. This maintained picklability but introduced a regression: `_check_still_parented()` calls `disconnect()` when `self.ref_artist.figure is None`, but `disconnect()` then tries to access `self.canvas` which requires `figure` to not be `None`.\n\n**Fix**: In `disconnect()`, wrap the initial `self.canvas` access in a `try/except AttributeError`. If the figure is `None` (meaning the artist has been detached from its figure), we return early rather than crashing. The `canvas` local variable is then used throughout the rest of `disconnect()` to avoid repeated property lookups.",
    "stop_reason": null,
    "session_id": "41133e3b-575a-4cca-89bd-adb33be2222f",
    "total_cost_usd": 2.0375897500000004,
    "usage": {
      "input_tokens": 37,
      "cache_creation_input_tokens": 46893,
      "cache_read_input_tokens": 1823417,
      "output_tokens": 32440,
      "server_tool_use": {
        "web_search_requests": 0,
        "web_fetch_requests": 0
      },
      "service_tier": "standard",
      "cache_creation": {
        "ephemeral_1h_input_tokens": 46893,
        "ephemeral_5m_input_tokens": 0
      },
      "inference_geo": "",
      "iterations": [],
      "speed": "standard"
    },
    "modelUsage": {
      "claude-sonnet-4-6": {
        "inputTokens": 37,
        "outputTokens": 32440,
        "cacheReadInputTokens": 1823417,
        "cacheCreationInputTokens": 46893,
        "webSearchRequests": 0,
        "costUSD": 2.0159747500000003,
        "contextWindow": 200000,
        "maxOutputTokens": 32000
      },
      "claude-haiku-4-5-20251001": {
        "inputTokens": 17850,
        "outputTokens": 753,
        "cacheReadInputTokens": 0,
        "cacheCreationInputTokens": 0,
        "webSearchRequests": 0,
        "costUSD": 0.021615,
        "contextWindow": 200000,
        "maxOutputTokens": 32000
      }
    },
    "permission_denials": [],
    "uuid": "80eaf693-d211-43d0-90ee-f90da643a019"
  },
  "session_id": "41133e3b-575a-4cca-89bd-adb33be2222f",
  "result_text": "The fix is clean and minimal. Here's the summary:\n\n**Bug**: `AttributeError: 'NoneType' object has no attribute 'canvas'` in `DraggableBase.disconnect()`.\n\n**Root cause**: Commit `dfaa991552` (\"Make draggable legends picklable\") changed `self.canvas` from a stored instance attribute to a property that computes `self.ref_artist.figure.canvas` on each access. This maintained picklability but introduced a regression: `_check_still_parented()` calls `disconnect()` when `self.ref_artist.figure is None`, but `disconnect()` then tries to access `self.canvas` which requires `figure` to not be `None`.\n\n**Fix**: In `disconnect()`, wrap the initial `self.canvas` access in a `try/except AttributeError`. If the figure is `None` (meaning the artist has been detached from its figure), we return early rather than crashing. The `canvas` local variable is then used throughout the rest of `disconnect()` to avoid repeated property lookups.",
  "total_cost_usd": 2.0375897500000004,
  "num_turns": 36
}