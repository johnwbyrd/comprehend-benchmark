{
  "config": "comprehend",
  "repo_dir": "/tmp/swebench_iu299bow/psf__requests",
  "wall_time_seconds": 52,
  "git_diff": "diff --git a/requests/models.py b/requests/models.py\nindex 0dc55568..2ababaf8 100644\n--- a/requests/models.py\n+++ b/requests/models.py\n@@ -9,6 +9,7 @@ This module contains the primary objects that power Requests.\n \n import collections\n import datetime\n+import socket\n \n from io import BytesIO, UnsupportedOperation\n from .hooks import default_hooks\n@@ -22,7 +23,7 @@ from .packages.urllib3.util import parse_url\n from .packages.urllib3.exceptions import DecodeError\n from .exceptions import (\n     HTTPError, RequestException, MissingSchema, InvalidURL,\n-    ChunkedEncodingError, ContentDecodingError)\n+    ChunkedEncodingError, ContentDecodingError, ConnectionError)\n from .utils import (\n     guess_filename, get_auth_from_url, requote_uri,\n     stream_decode_response_unicode, to_key_val_list, parse_header_links,\n@@ -640,6 +641,8 @@ class Response(object):\n                     raise ChunkedEncodingError(e)\n                 except DecodeError as e:\n                     raise ContentDecodingError(e)\n+                except socket.error as e:\n+                    raise ConnectionError(e)\n             except AttributeError:\n                 # Standard file-like object.\n                 while True:\n",
  "claude_output": {
    "type": "result",
    "subtype": "success",
    "is_error": false,
    "duration_ms": 49854,
    "duration_api_ms": 49421,
    "num_turns": 13,
    "result": "The fix is in place. Here's a summary of the changes made to `requests/models.py`:\n\n1. **Added `import socket`** (line 12) \u2014 needed to reference `socket.error`.\n\n2. **Added `ConnectionError` to the exceptions import** (line 26) \u2014 needed to raise the wrapping exception.\n\n3. **Added a `socket.error` catch in `generate()`** (lines 644-645) \u2014 this is the core fix. When `self.raw.stream()` raises a `socket.error` (e.g., \"Connection reset by peer\" with `errno 104`), it is now caught and re-raised as `requests.exceptions.ConnectionError`, consistent with how the library handles other low-level errors.\n\nThe bug was that `adapters.py` already handled `socket.error` during the initial request/send phase (line 389), but the streaming phase inside `iter_content()` had no equivalent guard \u2014 so raw `socket.error` exceptions escaped directly to the caller instead of being wrapped in a proper `requests` exception.",
    "stop_reason": null,
    "session_id": "3e6c9129-927b-4098-b1e5-651d19f4a25b",
    "total_cost_usd": 0.31280100000000005,
    "usage": {
      "input_tokens": 11,
      "cache_creation_input_tokens": 17170,
      "cache_read_input_tokens": 278267,
      "output_tokens": 2652,
      "server_tool_use": {
        "web_search_requests": 0,
        "web_fetch_requests": 0
      },
      "service_tier": "standard",
      "cache_creation": {
        "ephemeral_1h_input_tokens": 17170,
        "ephemeral_5m_input_tokens": 0
      },
      "inference_geo": "",
      "iterations": [],
      "speed": "standard"
    },
    "modelUsage": {
      "claude-sonnet-4-6": {
        "inputTokens": 11,
        "outputTokens": 2652,
        "cacheReadInputTokens": 278267,
        "cacheCreationInputTokens": 17170,
        "webSearchRequests": 0,
        "costUSD": 0.31280100000000005,
        "contextWindow": 200000,
        "maxOutputTokens": 32000
      }
    },
    "permission_denials": [],
    "uuid": "faf4ceaa-220e-44e6-addf-166a7f48df2f"
  },
  "session_id": "3e6c9129-927b-4098-b1e5-651d19f4a25b",
  "result_text": "The fix is in place. Here's a summary of the changes made to `requests/models.py`:\n\n1. **Added `import socket`** (line 12) \u2014 needed to reference `socket.error`.\n\n2. **Added `ConnectionError` to the exceptions import** (line 26) \u2014 needed to raise the wrapping exception.\n\n3. **Added a `socket.error` catch in `generate()`** (lines 644-645) \u2014 this is the core fix. When `self.raw.stream()` raises a `socket.error` (e.g., \"Connection reset by peer\" with `errno 104`), it is now caught and re-raised as `requests.exceptions.ConnectionError`, consistent with how the library handles other low-level errors.\n\nThe bug was that `adapters.py` already handled `socket.error` during the initial request/send phase (line 389), but the streaming phase inside `iter_content()` had no equivalent guard \u2014 so raw `socket.error` exceptions escaped directly to the caller instead of being wrapped in a proper `requests` exception.",
  "total_cost_usd": 0.31280100000000005,
  "num_turns": 13
}