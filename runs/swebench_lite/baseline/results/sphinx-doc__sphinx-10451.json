{
  "config": "baseline",
  "repo_dir": "/tmp/swebench_iu299bow/sphinx-doc__sphinx",
  "wall_time_seconds": 574,
  "git_diff": "diff --git a/sphinx/ext/autodoc/typehints.py b/sphinx/ext/autodoc/typehints.py\nindex d912cd7d5..91cfd30e3 100644\n--- a/sphinx/ext/autodoc/typehints.py\n+++ b/sphinx/ext/autodoc/typehints.py\n@@ -2,6 +2,7 @@\n \n import re\n from collections import OrderedDict\n+from inspect import Parameter\n from typing import Any, Dict, Iterable, Set, cast\n \n from docutils import nodes\n@@ -27,7 +28,12 @@ def record_typehints(app: Sphinx, objtype: str, name: str, obj: Any,\n             sig = inspect.signature(obj, type_aliases=app.config.autodoc_type_aliases)\n             for param in sig.parameters.values():\n                 if param.annotation is not param.empty:\n-                    annotation[param.name] = typing.stringify(param.annotation, mode)\n+                    if param.kind == Parameter.VAR_POSITIONAL:\n+                        annotation['*' + param.name] = typing.stringify(param.annotation, mode)\n+                    elif param.kind == Parameter.VAR_KEYWORD:\n+                        annotation['**' + param.name] = typing.stringify(param.annotation, mode)\n+                    else:\n+                        annotation[param.name] = typing.stringify(param.annotation, mode)\n             if sig.return_annotation is not sig.empty:\n                 annotation['return'] = typing.stringify(sig.return_annotation, mode)\n     except (TypeError, ValueError):\ndiff --git a/tests/roots/test-ext-autodoc/target/typehints.py b/tests/roots/test-ext-autodoc/target/typehints.py\nindex 6b0d6142c..d04a2e2b8 100644\n--- a/tests/roots/test-ext-autodoc/target/typehints.py\n+++ b/tests/roots/test-ext-autodoc/target/typehints.py\n@@ -99,3 +99,15 @@ class _ClassWithDocumentedInit:\n \n         :param x: Some integer\n         \"\"\"\n+\n+\n+class _ClassWithDocumentedInitAndStarArgs:\n+    \"\"\"Class docstring.\"\"\"\n+\n+    def __init__(self, x: int, *args: int, **kwargs: int) -> None:\n+        \"\"\"Init docstring.\n+\n+        :param x: Some integer\n+        :param *args: Some integer\n+        :param **kwargs: Some integer\n+        \"\"\"\ndiff --git a/tests/test_ext_autodoc_configs.py b/tests/test_ext_autodoc_configs.py\nindex c075a8e2d..38ba2ea0e 100644\n--- a/tests/test_ext_autodoc_configs.py\n+++ b/tests/test_ext_autodoc_configs.py\n@@ -1101,6 +1101,46 @@ def test_autodoc_typehints_description_with_documented_init_no_undoc_doc_rtype(a\n             '         **x** (*int*) -- Some integer\\n' == context)\n \n \n+@pytest.mark.sphinx('text', testroot='ext-autodoc',\n+                    confoverrides={'autodoc_typehints': \"description\"})\n+def test_autodoc_typehints_description_with_documented_init_and_star_args(app):\n+    (app.srcdir / 'index.rst').write_text(\n+        '.. autoclass:: target.typehints._ClassWithDocumentedInitAndStarArgs\\n'\n+        '   :special-members: __init__\\n',\n+        encoding='utf8'\n+    )\n+    app.build()\n+    context = (app.outdir / 'index.txt').read_text(encoding='utf8')\n+    assert context == ('class target.typehints._ClassWithDocumentedInitAndStarArgs(x, *args, **kwargs)\\n'\n+                       '\\n'\n+                       '   Class docstring.\\n'\n+                       '\\n'\n+                       '   Parameters:\\n'\n+                       '      * **x** (*int*) --\\n'\n+                       '\\n'\n+                       '      * ***args** (*int*) --\\n'\n+                       '\\n'\n+                       '      * ****kwargs** (*int*) --\\n'\n+                       '\\n'\n+                       '   __init__(x, *args, **kwargs)\\n'\n+                       '\\n'\n+                       '      Init docstring.\\n'\n+                       '\\n'\n+                       '      Parameters:\\n'\n+                       '         * **x** (*int*) -- Some integer\\n'\n+                       '\\n'\n+                       '         * ***args** (*int*) --\\n'\n+                       '\\n'\n+                       '           Some integer\\n'\n+                       '\\n'\n+                       '         * ****kwargs** (*int*) --\\n'\n+                       '\\n'\n+                       '           Some integer\\n'\n+                       '\\n'\n+                       '      Return type:\\n'\n+                       '         None\\n')\n+\n+\n @pytest.mark.sphinx('text', testroot='ext-autodoc',\n                     confoverrides={'autodoc_typehints': \"description\"})\n def test_autodoc_typehints_description_for_invalid_node(app):\n",
  "claude_output": {
    "type": "result",
    "subtype": "success",
    "is_error": false,
    "duration_ms": 571966,
    "duration_api_ms": 597821,
    "num_turns": 50,
    "result": "All 30 tests pass (excluding the pre-existing failure). Let me provide a summary of the fix:\n\n## Summary\n\nThe bug was that `*args` and `**kwargs` parameters were being duplicated when using `autodoc_typehints = \"description\"`.\n\n**Root cause:** In `record_typehints()`, parameter names were stored using `param.name`, which returns `args` for `*args` and `kwargs` for `**kwargs` (without the asterisks). However, when users document these parameters in their docstrings as `:param *args:` and `:param **kwargs:`, the names are stored with asterisks. This mismatch caused:\n\n1. The lookup for `args` in the existing docstring fields (`*args`) to fail\n2. New duplicate entries `args` and `kwargs` to be added alongside the existing `*args` and `**kwargs` entries\n\n**Fix:** In `record_typehints()`, use `inspect.Parameter.VAR_POSITIONAL` and `Parameter.VAR_KEYWORD` to detect variadic parameters and store them with the appropriate star prefix in the annotations dictionary:\n- `*args` \u2192 stored as `'*args'` \n- `**kwargs` \u2192 stored as `'**kwargs'`\n\nThis ensures that when `modify_field_list()` and `augment_descriptions_with_types()` look up parameter names in existing docstring fields, the names match correctly, preventing duplication.",
    "stop_reason": null,
    "session_id": "12ba04ce-60c1-4419-a0a2-40cf466d227f",
    "total_cost_usd": 2.5190249500000004,
    "usage": {
      "input_tokens": 52,
      "cache_creation_input_tokens": 58378,
      "cache_read_input_tokens": 2484234,
      "output_tokens": 25851,
      "server_tool_use": {
        "web_search_requests": 0,
        "web_fetch_requests": 0
      },
      "service_tier": "standard",
      "cache_creation": {
        "ephemeral_1h_input_tokens": 58378,
        "ephemeral_5m_input_tokens": 0
      },
      "inference_geo": "",
      "iterations": [],
      "speed": "standard"
    },
    "modelUsage": {
      "claude-sonnet-4-6": {
        "inputTokens": 52,
        "outputTokens": 25851,
        "cacheReadInputTokens": 2484234,
        "cacheCreationInputTokens": 58378,
        "webSearchRequests": 0,
        "costUSD": 2.2535144999999996,
        "contextWindow": 200000,
        "maxOutputTokens": 32000
      },
      "claude-haiku-4-5-20251001": {
        "inputTokens": 77068,
        "outputTokens": 8903,
        "cacheReadInputTokens": 908137,
        "cacheCreationInputTokens": 42491,
        "webSearchRequests": 0,
        "costUSD": 0.26551045000000006,
        "contextWindow": 200000,
        "maxOutputTokens": 32000
      }
    },
    "permission_denials": [],
    "uuid": "2035dc6e-7941-4306-9036-59b83a1f03fd"
  },
  "session_id": "12ba04ce-60c1-4419-a0a2-40cf466d227f",
  "result_text": "All 30 tests pass (excluding the pre-existing failure). Let me provide a summary of the fix:\n\n## Summary\n\nThe bug was that `*args` and `**kwargs` parameters were being duplicated when using `autodoc_typehints = \"description\"`.\n\n**Root cause:** In `record_typehints()`, parameter names were stored using `param.name`, which returns `args` for `*args` and `kwargs` for `**kwargs` (without the asterisks). However, when users document these parameters in their docstrings as `:param *args:` and `:param **kwargs:`, the names are stored with asterisks. This mismatch caused:\n\n1. The lookup for `args` in the existing docstring fields (`*args`) to fail\n2. New duplicate entries `args` and `kwargs` to be added alongside the existing `*args` and `**kwargs` entries\n\n**Fix:** In `record_typehints()`, use `inspect.Parameter.VAR_POSITIONAL` and `Parameter.VAR_KEYWORD` to detect variadic parameters and store them with the appropriate star prefix in the annotations dictionary:\n- `*args` \u2192 stored as `'*args'` \n- `**kwargs` \u2192 stored as `'**kwargs'`\n\nThis ensures that when `modify_field_list()` and `augment_descriptions_with_types()` look up parameter names in existing docstring fields, the names match correctly, preventing duplication.",
  "total_cost_usd": 2.5190249500000004,
  "num_turns": 50
}